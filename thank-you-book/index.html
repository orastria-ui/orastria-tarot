<!DOCTYPE html>
<html lang="en">
<head>
<!-- Meta Pixel Code with Advanced Matching -->
<script>
// SHA256 hash function for email/ip
async function sha256(message) {
  const msgBuffer = new TextEncoder().encode(message);
  const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
}

// Get user IP address
async function getUserIP() {
  try {
    const res = await fetch('https://api.ipify.org?format=json');
    const data = await res.json();
    return data.ip;
  } catch (e) {
    console.warn('Could not fetch IP:', e);
    return null;
  }
}

// Get tracking data
const urlParams = new URLSearchParams(window.location.search);
const uid = urlParams.get('uid') || localStorage.getItem('orastria_uid') || '';
const fbclid = localStorage.getItem('orastria_fbclid') || urlParams.get('fbclid') || '';
const storedEmail = localStorage.getItem('orastria_email') || '';
const userAgent = navigator.userAgent;

// Initialize pixel with advanced matching when data is ready
(async function() {
  !function(f,b,e,v,n,t,s)
  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
  n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];
  s.parentNode.insertBefore(t,s)}(window, document,'script',
  'https://connect.facebook.net/en_US/fbevents.js');

  // Get IP address
  const userIP = await getUserIP();

  // Build advanced matching object
  const advancedMatching = {};
  if (uid) advancedMatching.external_id = uid;
  if (fbclid) advancedMatching.fbc = 'fb.1.' + Date.now() + '.' + fbclid;
  if (storedEmail) {
    const emailHash = await sha256(storedEmail.toLowerCase().trim());
    advancedMatching.em = emailHash;
  }
  if (userIP) {
    // Meta expects hashed IP for client-side
    advancedMatching.client_ip_address = userIP;
  }
  if (userAgent) {
    advancedMatching.client_user_agent = userAgent;
  }

  console.log('üìä Meta Pixel init with:', advancedMatching);

  // Init with advanced matching
  fbq('init', '1196585509341329', advancedMatching);
  fbq('track', 'PageView');
  fbq('track', 'Purchase', {
    value: 7.99,
    currency: 'EUR',
    content_name: 'Orastria Full Book',
    content_type: 'product',
    content_ids: ['orastria-book']
  });

  console.log('‚úÖ Purchase event fired: ‚Ç¨7.99, IP:', userIP);
})();
</script>
<noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=1196585509341329&ev=PageView&noscript=1"
/></noscript>
<!-- End Meta Pixel Code -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Orastria ‚Äî Your Book is Being Prepared ‚ú®</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="thank-you.css" />
</head>
<body>

<!-- ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<header class="ty2-header">
  <img src="../book-1/assets/images/logo.avif" alt="Orastria" class="ty2-logo" />
</header>

<!-- ‚îÄ‚îÄ HERO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<section class="ty2-hero">
  <!-- Animated checkmark -->
  <div class="ty2-check-wrap">
    <svg class="ty2-check-svg" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
      <circle cx="32" cy="32" r="30" stroke="#c9a227" stroke-width="2" stroke-opacity="0.3"/>
      <circle cx="32" cy="32" r="30" stroke="#c9a227" stroke-width="2" stroke-dasharray="188.5" stroke-dashoffset="188.5" class="ty2-check-ring"/>
      <polyline points="18,33 27,43 46,22" stroke="#c9a227" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" stroke-dasharray="42" stroke-dashoffset="42" class="ty2-check-tick"/>
    </svg>
    <div class="ty2-check-glow"></div>
  </div>

  <h1 class="ty2-title">Payment confirmed,<br><em id="ty2-name">friend</em>. ‚ú®</h1>
  <p class="ty2-sub">Your complete personalised astrology book is being prepared right now. You'll receive it by email within a few minutes.</p>

  <!-- Email reminder badge -->
  <div class="ty2-email-badge">
    <span class="ty2-email-icon">üì¨</span>
    Check your inbox ‚Äî it's on its way
  </div>
</section>

<!-- ‚îÄ‚îÄ WHAT HAPPENS NEXT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<section class="ty2-steps-section">
  <h2 class="ty2-steps-title">What happens next</h2>
  <div class="ty2-steps">
    <div class="ty2-step">
      <div class="ty2-step-num">1</div>
      <div class="ty2-step-body">
        <strong>We generate your book</strong>
        <span>Your 137-page reading is being personalised around your exact birth chart right now.</span>
      </div>
    </div>
    <div class="ty2-step-divider"></div>
    <div class="ty2-step">
      <div class="ty2-step-num">2</div>
      <div class="ty2-step-body">
        <strong>You receive it by email</strong>
        <span>A download link lands in your inbox within a few minutes. Check your spam folder if you don't see it.</span>
      </div>
    </div>
    <div class="ty2-step-divider"></div>
    <div class="ty2-step">
      <div class="ty2-step-num">3</div>
      <div class="ty2-step-body">
        <strong>Read it at your own pace</strong>
        <span>Your book is yours forever ‚Äî save it, print it, revisit it whenever you need guidance.</span>
      </div>
    </div>
  </div>
</section>

<!-- ‚îÄ‚îÄ BOOK PREVIEW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<section class="ty2-book-section">
  <p class="ty2-book-label">A glimpse of what's inside</p>
  <div class="ty2-book-wrap">

    <!-- Floating book SVG -->
    <div class="ty2-book-float">
      <svg class="ty2-book-svg" viewBox="0 0 180 240" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect x="10" y="5" width="160" height="230" rx="4" fill="#1a1a2e"/>
        <rect x="10" y="5" width="160" height="230" rx="4" stroke="#c9a227" stroke-width="2"/>
        <rect x="22" y="17" width="136" height="206" rx="2" stroke="#c9a227" stroke-width="0.8" stroke-opacity="0.4"/>

        <!-- name band -->
        <rect x="22" y="24" width="136" height="26" rx="2" fill="#c9a227" fill-opacity="0.1"/>
        <rect x="22" y="24" width="136" height="26" rx="2" stroke="#c9a227" stroke-width="0.6" stroke-opacity="0.5"/>
        <text x="90" y="41" text-anchor="middle" fill="#c9a227" font-family="Georgia, serif" font-size="12" font-weight="bold" letter-spacing="0.5" id="ty2-cover-name">Your Name</text>
        <text x="90" y="58" text-anchor="middle" fill="#c9a227" font-family="Georgia, serif" font-size="6.5" fill-opacity="0.75" letter-spacing="2">BIRTH CHART READING</text>

        <!-- chart rings -->
        <circle cx="90" cy="128" r="54" stroke="#c9a227" stroke-width="0.9" stroke-opacity="0.65"/>
        <circle cx="90" cy="128" r="39" stroke="#6b5b95" stroke-width="0.9" stroke-opacity="0.75"/>
        <circle cx="90" cy="128" r="24" stroke="#c9a227" stroke-width="0.9" stroke-opacity="0.65"/>
        <circle cx="90" cy="128" r="8" fill="#c9a227" fill-opacity="0.12" stroke="#c9a227" stroke-width="0.9"/>

        <!-- spokes -->
        <line x1="90" y1="74" x2="90" y2="62" stroke="#c9a227" stroke-width="0.8" stroke-opacity="0.5"/>
        <line x1="90" y1="182" x2="90" y2="194" stroke="#c9a227" stroke-width="0.8" stroke-opacity="0.5"/>
        <line x1="36" y1="128" x2="24" y2="128" stroke="#c9a227" stroke-width="0.8" stroke-opacity="0.5"/>
        <line x1="144" y1="128" x2="156" y2="128" stroke="#c9a227" stroke-width="0.8" stroke-opacity="0.5"/>

        <!-- planet dots -->
        <circle cx="90" cy="89" r="4" fill="#c9a227"/>
        <circle cx="117" cy="103" r="3" fill="#c9a227" fill-opacity="0.7"/>
        <circle cx="144" cy="128" r="4" fill="#6b5b95"/>
        <circle cx="68" cy="160" r="3" fill="#c9a227" fill-opacity="0.5"/>

        <!-- zodiac glyph -->
        <g transform="translate(82, 193) scale(0.8)" fill="none" stroke="#c9a227" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 8 C3 5 6 3 10 3 C14 3 17 5 17 8 C17 11 14 13 10 13 C6 13 3 11 3 8 M10 13 L10 19 M7 19 L13 19"/>
        </g>

        <!-- date -->
        <text x="90" y="216" text-anchor="middle" fill="#c9a227" font-family="Georgia, serif" font-size="6.5" fill-opacity="0.7">Jan 1, 1990</text>

        <!-- spine -->
        <rect x="5" y="5" width="7" height="230" rx="1" fill="#0f0f1a"/>
        <text x="9" y="155" text-anchor="middle" fill="#c9a227" font-family="Georgia, serif" font-size="6" fill-opacity="0.5" letter-spacing="2" transform="rotate(-90, 9, 120)">ORASTRIA</text>
      </svg>
      <div class="ty2-book-glow"></div>
    </div>

    <!-- Chapters teaser -->
    <div class="ty2-chapters">
      <p class="ty2-chapters-label">Your book includes</p>
      <ul class="ty2-chapters-list">
        <li><span class="ty2-ch-num">01</span><span>Your Sun, Moon & Rising ‚Äî who you truly are</span></li>
        <li><span class="ty2-ch-num">02</span><span>Love & relationships ‚Äî your compatibility map</span></li>
        <li><span class="ty2-ch-num">03</span><span>Life path & soul purpose</span></li>
        <li><span class="ty2-ch-num">04</span><span>Career, money & timing windows</span></li>
        <li><span class="ty2-ch-num">05</span><span>2025‚Äì2026 predictions & key dates</span></li>
        <li><span class="ty2-ch-num">06</span><span>Shadow work & spiritual growth</span></li>
        <li><span class="ty2-ch-num">07</span><span>Tarot & numerology profile</span></li>
        <li class="ty2-ch-more">+ much more across 137 pages</li>
      </ul>
    </div>
  </div>
</section>

<!-- ‚îÄ‚îÄ GUARANTEE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<section class="ty2-guarantee-section">
  <div class="ty2-guarantee-card">
    <div class="ty2-guarantee-icon">üõ°Ô∏è</div>
    <div>
      <strong>30-Day Money-Back Guarantee</strong>
      <p>If you're not completely satisfied with your book, email us within 30 days and we'll refund you in full ‚Äî no questions asked.</p>
    </div>
  </div>
</section>

<!-- ‚îÄ‚îÄ SHARE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<section class="ty2-share-section">
  <p class="ty2-share-label">Know someone who would love this?</p>
  <div class="ty2-share-btns">
    <button class="ty2-share-btn ty2-share-wa" onclick="shareWhatsApp()">
      <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347z"/><path d="M12 0C5.373 0 0 5.373 0 12c0 2.122.554 4.118 1.523 5.853L0 24l6.343-1.501A11.933 11.933 0 0012 24c6.627 0 12-5.373 12-12S18.627 0 12 0zm0 21.818a9.817 9.817 0 01-5.002-1.368l-.358-.213-3.766.892.938-3.669-.234-.374A9.787 9.787 0 012.182 12C2.182 6.57 6.57 2.182 12 2.182c5.43 0 9.818 4.388 9.818 9.818 0 5.43-4.388 9.818-9.818 9.818z"/></svg>
      Share on WhatsApp
    </button>
    <button class="ty2-share-btn ty2-share-copy" onclick="copyLink()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
      <span id="ty2-copy-label">Copy link</span>
    </button>
  </div>
</section>

<!-- ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<footer class="ty2-footer">
  <img src="../book-1/assets/images/logo.avif" alt="Orastria" class="ty2-footer-logo" />
  <p>Questions? Email us at <a href="mailto:hello@orastria.com">hello@orastria.com</a></p>
  <p class="ty2-footer-small">¬© 2025 Orastria ¬∑ All rights reserved</p>
</footer>

<script src="../user-tracking.js"></script>
<script src="supabase-integration.js"></script>
<script>
// ‚îÄ‚îÄ Name personalisation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const params = new URLSearchParams(window.location.search);
const name = params.get('name') || localStorage.getItem('orastria_name') || '';

if (name) {
  const firstName = name.split(' ')[0]; // Use first name only
  document.getElementById('ty2-name').textContent = firstName;
  document.getElementById('ty2-cover-name').textContent = firstName;
}

console.log('‚úì Thank you page loaded, user:', name || 'friend');

// ‚îÄ‚îÄ Track purchase in Supabase ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Wait for tracking scripts to initialize
setTimeout(() => {
  if (window.orastriaTracking) {
    window.orastriaTracking.trackPurchase();
  }
}, 1000);

// ‚îÄ‚îÄ Animated checkmark on load ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
window.addEventListener('load', () => {
  setTimeout(() => {
    document.querySelector('.ty2-check-ring').classList.add('animate');
    setTimeout(() => {
      document.querySelector('.ty2-check-tick').classList.add('animate');
    }, 500);
  }, 300);
});

// ‚îÄ‚îÄ Share helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function shareWhatsApp() {
  const text = encodeURIComponent('I just got my personalised astrology book from Orastria ‚Äî it\'s incredible! Check it out: https://orastria.com');
  window.open('https://wa.me/?text=' + text, '_blank');
}

function copyLink() {
  navigator.clipboard.writeText('https://orastria.com').then(() => {
    const label = document.getElementById('ty2-copy-label');
    label.textContent = 'Copied! ‚úì';
    setTimeout(() => label.textContent = 'Copy link', 2500);
  });
}
</script>

</body>
</html>
